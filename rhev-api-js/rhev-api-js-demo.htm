<html>
<head>
<title>RHEV Rest in Javascript Demo</title>
<script type="text/javascript"
	src="http://code.jquery.com/jquery-1.4.4.js"></script>
<script type="text/javascript">

/*
 * Author: Tomas Von Veschler <tvvcox>
 * Url: https://code.google.com/p/rhev-api-labs/
 */

// Pre-fill form values here for more comfortable testing
url = 'https://example.com:8443';
entry = '/rhevm-api-powershell'; // NOTICE: no trailing slash
user = 'rhevadmin@example.com'; // Format: user@dmain.com
pass = 'XXX';

    
rhev = {
    _url: null,
    _username: null,
    _password: null,
    init: function(url, user, pass) {
        this._url = url;
        this._user = user;
        this._pass = pass;
    },
    call: function(callback, method, path, body) {
        //This sneaky bit tries to disable the Same Origin Policy
        if (navigator.userAgent.indexOf("Firefox") != -1) {
            try {
                netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
            }  catch (e) {
                alert("Permission UniversalBrowserRead denied -- not running Mozilla?");
            }
        }
        $.ajax({
            type: method,
            url: this._url + path,
            username: this._user,
            password: this._pass,
            dataType: 'json',
            success: callback,
            error: function(XMLHttpRequest, textStatus, errorThrown) {
            alert('RHEV Error: '+textStatus+'-'+errorThrown);
            }
        });
    }
}


function buildTable(data) {
    if (!data) {
        alert("Request succesful but no data, running Chrome?");
        return false;
    }
    table = $("#foo table");
    table.toggle(false);
    $.each(data.hosts, function(i, host) {
        table.append("<tr><td>"+host.name+"</td>"+"<td>"+host.status+"</td></tr>");
    });
    table.fadeIn('slow');
}

$(document).ready(function() {

    $("#url").val(url);
    $("#username").val(user);
    $("#password").val(pass);
    $("#entry").val(entry);

    $("button").click(function() {
        url = $("#url").val();
        user = $("#username").val();
        pass = $("#password").val();
        entry = $("#entry").val();
        rhev.init(url, user, pass);
        rhev.call(buildTable, "GET", entry + "/hosts");
    });
});

</script>
</head>
<body>
<table>
    <tr>
        <td>Username</td>
        <td>Password</td>
        <td>Url</td>
        <td>Entry</td>
    </tr>
    <tr>
        <td><input type="text" id="username" size=20></td>
        <td><input type="password" id="password" size=10></td>
        <td><input type="text" id="url" size=40></td>
        <td><input type="text" id="entry">
        <button>Go!</button>
        </td>
    </tr>
</table>
<hr>
<div id="foo">
<table border=1>
</table>
</div>

</body>
</html>